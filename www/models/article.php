<?php// TODO PDO::prepare() ?include 'models/PdoDB.php';// Список всех статей//function articles_all() {    include $_SERVER['DOCUMENT_ROOT'] . "/config/config.php";    try {                $query = "SELECT * FROM pro_articles ORDER BY id_article DESC";        $stmt = PdoDB::query($query);               $articles = array();        while ($row = $stmt->fetch()) {            $articles[] = $row;        }        $pdo = null;        return $articles;    } catch (PDOException $e) {        echo "ошибка выборки статей " . $e;        $pdo = null;        return false;    }}//// Конкретная статья//function articles_get($id_article) {    // Запрос.    include $_SERVER['DOCUMENT_ROOT'] . "/config/config.php";    try {                $t = "SELECT * FROM pro_articles             WHERE id_article = '%d'";                $query = sprintf($t, $id_article);        $stmt = PdoDB::query($query);        $article = $stmt->fetch();               return $article;    } catch (PDOException $e) {                echo "ошибка выборки статьи " . $e;               return false;    }}//// Добавить статью//function articles_new($title, $content) {    include $_SERVER['DOCUMENT_ROOT'] . "/config/config.php";    try {        //$pdo = new PDO("mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . "", DB_USER, DB_PSWD);        //PdoDB::exec("SET CHARACTER SET utf8");        //PdoDB::exec("SET NAMES utf8");        // Подготовка.        $title = trim($title);        $content = trim($content);        // Проверка.        if ($title == '')            return false;        // Запрос.        $query = "INSERT INTO pro_articles (title, content) VALUES ('$title', '$content')";        PdoDB::exec($query);        //$pdo = null;        return true;    } catch (PDOException $e) {        echo "ошибка добавления статьи " . $e;        //$pdo = null;        return false;    }}//// Изменить статью//function articles_edit($id_article, $title, $content) {        include $_SERVER['DOCUMENT_ROOT'] . "/config/config.php";    try {               $query = "UPDATE pro_articles SET title = '$title', content = '$content'         WHERE id_article = '$id_article'";        PdoDB::exec($query);               return true;    } catch (PDOException $e) {        echo "ошибка редактирования статьи " . $e;        return false;    }}//// Удалить статью//function articles_delete($id_article) {    include $_SERVER['DOCUMENT_ROOT'] . "/config/config.php";    try {                $t = "DELETE FROM pro_articles WHERE id_article = '%d'";        $query = sprintf($t, $id_article);                if ($cnt = PdoDB::exec($query)) {            header("Location: editor.php");            exit;        } else {            echo "удалено записей: " . $cnt;            return false;        }    } catch (PDOException $e) {        echo "ошибка удаления статьи " . $e;                return false;    }}//// Короткое описание статьи//function articles_intro($article) {    // $article - это ассоциативный массив, представляющий статью    $intros = array();    $anonse = 90;    include $_SERVER['DOCUMENT_ROOT'] . "/config/config.php";    try {        foreach ($article as $intro) {                        // Запрос. выбираем текст слева = анонсу            $id_intro = (int) $intro['id_article'];                        $query = "SELECT LEFT(content, $anonse) as intro, id_article             FROM pro_articles             WHERE id_article = '$id_intro'                 ORDER BY id_article DESC";            $stmt = PdoDB::query($query);            $row = $stmt->fetch();            $row['intro'] = $row['intro'] . "...";            $intros[$row['id_article']] = $row['intro'];        }        return $intros;    } catch (PDOException $e) {        echo "ошибка выборки интро " . $e;        return false;    }}?>